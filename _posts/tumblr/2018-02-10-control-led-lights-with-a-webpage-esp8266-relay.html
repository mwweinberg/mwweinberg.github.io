---
layout: post
title: Control LED Lights With A Webpage (ESP8266 Relay)
date: '2018-02-10T11:05:20-05:00'
tags:
- projects
tumblr_url: http://michaelweinberg.org/post/170722380870/control-led-lights-with-a-webpage-esp8266-relay
---
<p>This is a quick tutorial on how to set up a simple web controlled relay using Adafruit’s Huzzah ESP8266 board and Adafruit’s Latching Relay Featherwing.  When you are done you will be able to open a web page while on your local network (on your phone, on your laptop, on anything with a browser) and turn lights plugged into the wall on or off. </p><p>95% of this is pieced together from other places online, but when I was piecing I couldn’t quite find it all in one place.  Hence this blog post.  The entire process is pretty easy as these things go.</p><p>In order to make this work you need 1) something connected to your home network that hosts the website and turns inputs on the website into action, and 2) something to translate that “action” into power going on or off.  That’s the Huzzah ESP8266 board and the Latching Relay Featherwing, respectively.</p><p>Practically, you will need:</p><ul><li>An ESP8266 breakout board (I used the <a href="https://www.adafruit.com/product/2471" target="_blank">Adafruit Huzzah</a> because I knew it would be well documented)<br/></li></ul><ul><li>A USB to TTL serial cable (I used the <a href="https://www.adafruit.com/product/954" target="_blank">Adafruit one</a> too) to program the Huzzah.  Note that it will also power the board during development.<br/></li></ul><p></p><ul><li>A mictrocontroller-friendly relay (I used the <a href="https://www.adafruit.com/product/2923" target="_blank">Adafruit Latching Relay Featherwing</a>)</li></ul><ul><li>Some LEDs to turn on (I grabbed <a href="https://www.amazon.com/gp/product/B076HM4ZF3/ref=oh_aui_detailpage_o01_s00?ie=UTF8&amp;psc=1" target="_blank">these</a>).  </li></ul><ul><li>Some wires, a breadboard, and a soldering iron will also help</li></ul><p>For the purposes of this project you could use pretty much anything that uses a moderate amount of electricity as the thing that is turned on (you are just creating a remote controlled switch).  The most appealing features of the LEDs I chose were 1) that they plugged into the wall instead of being battery powered (relevant to the long term use I have in mind), and 2) that it was easy to access the power cord downstream from the power adapter so that the loads were less dangerous.</p><h2>Programming</h2><p>I very much recommend using the <a href="https://learn.adafruit.com/adafruit-huzzah-esp8266-breakout" target="_blank">Adafruit tutorial for setting up the Huzzah</a>.  Once you’ve successfully blinked a light with the Arduino IDE come back here.</p><p>The code is taken from <a href="https://www.teachmemicro.com/simple-nodemcu-web-server/" target="_blank">this post</a>, which is also a great post about using the ESP8266 boards as simple web servers.  The only thing I added as the CSS styling, which I’ll get to in a second.</p><blockquote><p>#include &lt;ESP8266WiFi.h&gt;<br/>#include &lt;WiFiClient.h&gt;<br/>#include &lt;ESP8266WebServer.h&gt;</p><p>// Replace with your network credentials<br/>const char* ssid = &ldquo;YOUR_SSID&rdquo;;<br/>const char* password = &ldquo;YOUR_WIFI_PASSWORD&rdquo;;</p><p>ESP8266WebServer server(80);   //instantiate server at port 80 (http port)</p><p>String page = &ldquo;&rdquo;;<br/>int LEDUnsetPin = 0;<br/>int LEDSetPin = 2;<br/>void setup(void){<br/>  //the HTML of the web page<br/>  //don&rsquo;t forget you need estapes (") around the quotes<br/>  page = &ldquo;&lt;style&gt;  .button{    background-color:red;    color:blue;    border-radius: 8px;    padding: 12px 24px;  }&lt;/style&gt;&lt;h1&gt;Simple NodeMCU Web Server&lt;/h1&gt;&lt;p&gt;    &lt;a href="LEDOn"&gt;&lt;button class="button"&gt;ON&lt;/button&gt;&lt;/a&gt;    &amp;nbsp;    &lt;a href="LEDOff"&gt;&lt;button&gt;OFF&lt;/button&gt;&lt;/a&gt;&lt;/p&gt;&rdquo;;<br/>  //make the LED pins output and initially turned off<br/>  pinMode(LEDUnsetPin, OUTPUT);<br/>  digitalWrite(LEDUnsetPin, LOW);<br/>  pinMode(LEDSetPin, OUTPUT);<br/>  digitalWrite(LEDSetPin, LOW);</p><p>  delay(1000);<br/>  Serial.begin(115200);<br/>  WiFi.begin(ssid, password); //begin WiFi connection<br/>  Serial.println(&ldquo;&rdquo;);</p><p>  // Wait for connection<br/>  while (WiFi.status() != WL_CONNECTED) {<br/>    delay(500);<br/>    Serial.print(&ldquo;.&rdquo;);<br/>  }<br/>  Serial.println(&ldquo;&rdquo;);<br/>  Serial.print(&ldquo;Connected to &rdquo;);<br/>  Serial.println(ssid);<br/>  Serial.print(&ldquo;IP address: &rdquo;);<br/>  Serial.println(WiFi.localIP());</p><p>  server.on(&ldquo;/&rdquo;, [](){<br/>    server.send(200, &ldquo;text/html&rdquo;, page);<br/>  });</p><p>  //turn on the on pin and turn off the off pin<br/>  server.on(&ldquo;/LEDOn&rdquo;, [](){<br/>    server.send(200, &ldquo;text/html&rdquo;, page);<br/>    digitalWrite(LEDUnsetPin, LOW);<br/>    digitalWrite(LEDSetPin, HIGH);<br/>    delay(1000); <br/>  }); </p><p>  //turn off the on pin and turn on the off pin<br/>  server.on(&ldquo;/LEDOff&rdquo;, [](){<br/>    server.send(200, &ldquo;text/html&rdquo;, page);<br/>    digitalWrite(LEDUnsetPin, HIGH);<br/>    digitalWrite(LEDSetPin, LOW);<br/>    delay(1000); <br/>  });<br/>  server.begin();<br/>  Serial.println(&ldquo;Web server started!&rdquo;);<br/>}</p><p>void loop(void){<br/>  server.handleClient();<br/>}</p></blockquote><p>Make sure to replace “YOUR_SSID” and “YOUR_WIFI_PASSWORD” with your wifi network ssid and wifi password.</p><p>As I noted above, the only modification I made to the code was to add styling to the server.  The code above isn’t the final styling - it is just a first cut to verify that the way I thought styling would work was the way that styling actually worked.</p><p>The “page=“ part of the code is the HTML for the webpage you will visit with your browser to control the lights. It may look more familiar once it is converted from a string into a more standard layout (apologies - tumblr is very bad with tabs but this may be a bit better):</p><blockquote><p>&lt;style&gt;  .button{   </p><p>background-color:red;   </p><p> color:blue;    </p><p>border-radius: 8px;    </p><p>padding: 12px 24px;  </p><p>}</p><p>&lt;/style&gt;</p><p>&lt;h1&gt;Simple NodeMCU Web Server&lt;/h1&gt;</p><p>&lt;p&gt;    &lt;a href="LEDOn"&gt;&lt;button class="button"&gt;ON&lt;/button&gt;&lt;/a&gt;    &amp;nbsp;    &lt;a href="LEDOff"&gt;&lt;button&gt;OFF&lt;/button&gt;&lt;/a&gt;&lt;/p&gt;<br/></p></blockquote><p>The links to LEDOn and LEDOff trigger the server.on functions further down in the code.  Since the latching relay has two pins, each function turns off and turns on the appropriate pins on the relay so that the relay is either open or closed.  If you were using a non-latching relay there would only be one pin that was either HIGH or LOW as necessary.  Those pins were defined in LEDUnsetPin and LEDSetPin at the start of the code.</p><p>The nice thing about mapping LEDUnsetPin and LEDSetPin to pins 0 and 2 is that those pins are also mapped to leds on the Huzzah board.  That means that you can test the sketch to make sure it works by just seeing if the lights turn from blue to red.  Of course, to do that you’ll need to go to the webpage that the Huzzah is hosing.</p><h2>Finding the Huzzah on the Network</h2><p>In theory the serial monitor in the Arduino IDE will return a message with your Huzzah’s IP address.  I found that to be a somewhat unreliable action.  Instead, I just went to the connected devices section of my router and looked for it in the table.  Once all of this is set up I’ll use the router to assign the Huzzah a static IP address so it is easy to find.  For the development period I just track it down in the router every time.</p><p>Once you have the IP address (probably some variation of 192.168.1.X) you can just type it into your browser.  If everything is going well you’ll see the webpage with two buttons (one with ugly styling):</p><figure data-orig-width="555" data-orig-height="121" class="tmblr-full"><img src="/images/2018-02-10-control-led-lights-with-a-webpage-esp8266-relay.html0.png" alt="image" data-orig-width="555" data-orig-height="121"/></figure><p>Clicking on or off will turn on a red or blue LED on the Huzzah.  If that is happening things are working out just fine so far.</p><h2>Hooking up the Relay</h2><p>Now that the Huzzah is connected to your network, serving up a web page, and responding to clicks on that web page, it is time to connect the Huzzah to the relay.  </p><p>Note that I’ve been having problems uploading scripts to the Huzzah when it is connected to the relay.  That means it is probably best to have the final version of the code loaded into the Huzzah before you solder it all together (obviously you can breadboard it to your heart’s content).</p><p>There are four connections between the Huzzah and the relay to  make this work.  Unfortunately fritzing does not have the latching relay featherwing in its library, so we’re stuck with my description and this picture:</p><figure class="tmblr-full" data-orig-height="3024" data-orig-width="4032"><img src="/images/2018-02-10-control-led-lights-with-a-webpage-esp8266-relay.html1.jpg" data-orig-height="3024" data-orig-width="4032"/></figure><p>Fortunately there are only four connections so words should be able to get us most of the way.</p><ul><li>Connect the GND pin on the huzzah to the GND pin on the relay<br/></li><li>Connect the 3V pin on the huzzah to the 3V pin on the relay<br/></li><li>Connect the #2 pin on the huzzah to the SET pin on the relay<br/></li><li>Connect the #0 pin on the huzzah to the UNSET pin on the relay<br/></li></ul><p>Once you have that up and running try controlling it all with the webpage again.  If things are working every time you click a button on the webpage you will switch the LED on the huzzah and hear a nice click from the relay.</p><h2>Connecting the Relay to the Lights</h2><p>The last step is to make that click impact something you care about.  Cut the live wire on the LED power cable (obvious notes about electricity plugs into walls apply - make sure you know what you are doing and take appropriate precautions) and plug it into the “COM” and “NO” ports on the relay.  Plug the lights into an outlet.  </p><p>At this point if everything is working when you click a button on the webpage you should get</p><ol><li>An LED switch on the huzzah<br/></li><li>A satisfying click on the relay<br/></li><li>Lights on or off<br/></li></ol><p>And that’s pretty much it.  At some point you’ll need to switch the power for the huzzah/relay from the computer you are using for debugging to a real power supply.  I haven’t done that yet but will update when I do.</p>
